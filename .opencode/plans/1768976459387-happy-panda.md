# Plan: Make ctrl-t fzf selection work with prefix directory

## Goal
When the command line contains something like `ls dir/` and ctrl-t is pressed, fzf should search within `dir/` instead of the current directory.

## Current Setup
- `FZF_CTRL_T_COMMAND=esamatti-fzf-find` (line 182)
- `esamatti-fzf-find` script uses `git ls-files` or `fd` but does NOT accept directory arguments
- fzf keybindings loaded via `source <(fzf --zsh)` (line 168)

## Implementation

### 1. Modify `bin/esamatti-fzf-find` to accept a directory argument

The script will accept an optional directory argument. Paths are output relative to CWD (not the prefix dir) so they work directly in commands.

```sh
#!/bin/sh

set -eu

dir="${1:-.}"

if git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
    # git ls-files outputs paths relative to repo root, but with a prefix it works correctly
    exec git ls-files -- "$dir"
fi

if [ -x "$(command -v fd)" ]; then
    # fd with a directory argument outputs full paths from that dir
    # --strip-cwd-prefix makes them relative to CWD which is what we want
    exec fd --type f --strip-cwd-prefix . "$dir"
fi

echo "Not in a git repo" >&2
exit 1
```

### 2. Add custom `fzf-file-widget` to `init.zsh` (after line 168)

Override the default fzf-file-widget to extract the last word from `$LBUFFER` and pass it as a directory argument if it's a valid directory:

```zsh
# Custom fzf-file-widget with prefix directory support
fzf-file-widget() {
  local prefix_dir=""
  local lbuf_trimmed="${LBUFFER##* }"  # Get last word (after last space)
  
  # Check if the last word is a directory
  if [[ -n "$lbuf_trimmed" && -d "$lbuf_trimmed" ]]; then
    prefix_dir="$lbuf_trimmed"
  fi
  
  local selected
  if [[ -n "$prefix_dir" ]]; then
    selected="$(FZF_CTRL_T_COMMAND="$FZF_CTRL_T_COMMAND $prefix_dir" __fzf_select)"
  else
    selected="$(__fzf_select)"
  fi
  
  LBUFFER="${LBUFFER}${selected}"
  local ret=$?
  zle reset-prompt
  return $ret
}
zle -N fzf-file-widget
```

## Files to Modify
1. `/Users/esamatti/code/dotfiles/bin/esamatti-fzf-find` - Add directory argument support
2. `/Users/esamatti/code/dotfiles/init.zsh` - Add custom fzf-file-widget after line 168

## Verification
1. Open a new terminal (or `source ~/.zshrc`)
2. Type `ls ` and press ctrl-t → should show all files (no prefix)
3. Type `ls bin` and press ctrl-t → should show only files in `bin/` directory
4. Type `ls /tmp` and press ctrl-t → should show files in `/tmp/`
