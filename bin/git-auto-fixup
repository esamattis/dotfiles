#!/bin/bash

set -eu
set -o pipefail

git add-untracked "${1:-}"

if [ "${2:-}" != "" ]; then
    branch="$2"
elif gh pr view &>/dev/null; then
    branch="origin/$(gh pr view --json baseRefName -q .baseRefName)"
else
    branch="$(git rev-parse --abbrev-ref --symbolic-full-name @{u})"
fi

rev=$(git log --oneline HEAD...$branch | fzf --reverse --height 40% --border --ansi --preview 'git show --color=always {1}' | awk '{print $1}')

git commit --fixup=$rev

