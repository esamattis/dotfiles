#!/bin/sh

set -eu

dir="${1:-}"

# When a directory argument is given, always use fd (not git ls-files)
# because git ls-files only shows tracked files
if [ -n "$dir" ]; then
    if [ -x "$(command -v fd)" ]; then
        exec fd --type f . "$dir"
    fi
    exec find "$dir" -type f
fi

# No directory argument - use git ls-files if in a git repo
if git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
    exec git ls-files
fi

if [ -x "$(command -v fd)" ]; then
    exec fd --type f --strip-cwd-prefix
fi

echo "Not in a git repo" >&2
exit 1
