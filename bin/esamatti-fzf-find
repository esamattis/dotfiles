#!/bin/sh

set -eu

dir="${1:-.}"

if git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
    # git ls-files outputs paths relative to repo root, but with a prefix it works correctly
    exec git ls-files -- "$dir"
fi

if [ -x "$(command -v fd)" ]; then
    # fd with a directory argument outputs full paths from that dir
    # --strip-cwd-prefix makes them relative to CWD which is what we want
    exec fd --type f --strip-cwd-prefix . "$dir"
fi

echo "Not in a git repo" >&2
exit 1
